# ArgoCD Image Update Flow - Visual Diagrams

## Problem: Current Setup (BROKEN âŒ)

```
DEVELOPER                          GITHUB ACTIONS              KUBERNETES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ git push    â”‚                   â”‚ 1. Build     â”‚            â”‚ Cluster  â”‚
â”‚ main branch â”‚ â”€â”€pushâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ 2. Push ECR  â”‚            â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ 3. kubectl   â”‚ â”€â”€applyâ”€â”€> â”‚ Running  â”‚
                                  â”‚    set       â”‚            â”‚ Old pods â”‚
                                  â”‚    image âŒ  â”‚            â”‚ OR New   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ pods?    â”‚
                                         â†“                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   Deploys directly                 â†‘
                                   No Git record!           GitHub Actions
                                                           bypasses ArgoCD
                                  
ARGOCD (CONFUSED âŒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Watches: k8s/services/event-ingestion/   â”‚
â”‚ deployment.yaml                          â”‚
â”‚                                          â”‚
â”‚ Sees: No change (GitHub Actions          â”‚
â”‚       didn't update Git!)                â”‚
â”‚                                          â”‚
â”‚ Result: Doesn't sync, doesn't know       â”‚
â”‚         about new image                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Problem: GitHub Actions and ArgoCD fighting!
GitHub Actions thinks it deployed.
ArgoCD thinks nothing changed.
No GitOps principle!
```

---

## Solution: Fixed Setup (WORKING âœ…)

```
DEVELOPER                   GITHUB                    GITHUB ACTIONS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            ACTIONS                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ git push    â”‚ â”€â”€pushâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ 1. Build image   â”‚
â”‚ main        â”‚           â”‚ Triggered   â”‚ â”€â”€runâ”€â”€â”€â”€> â”‚ 2. Push to ECR   â”‚
â”‚ branch      â”‚           â”‚ workflow    â”‚            â”‚ 3. Update Git!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚ UPDATE GIT     â”‚
                                                    â”‚ deployment.yamlâ”‚
                                                    â”‚ with new image â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â†“
                                                    GITHUB (updated)
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚ k8s/services/    â”‚
                                                    â”‚ event-ingestion/ â”‚
                                                    â”‚ deployment.yaml  â”‚
                                                    â”‚ image: NEW_TAG âœ…â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                            â†“
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ ARGOCD DETECTS CHANGE (âœ…)   â”‚
                                        â”‚                              â”‚
                                        â”‚ 1. Polls Git every 3 min    â”‚
                                        â”‚ 2. Sees: deployment.yaml    â”‚
                                        â”‚    changed                  â”‚
                                        â”‚ 3. Compares Git vs          â”‚
                                        â”‚    Kubernetes               â”‚
                                        â”‚ 4. Status: OutOfSync âš ï¸    â”‚
                                        â”‚ 5. Waits for approval       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â†“
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ OPERATOR APPROVES            â”‚
                                        â”‚ (Manual safety check)        â”‚
                                        â”‚                              â”‚
                                        â”‚ argocd app sync              â”‚
                                        â”‚ event-ingestion-prod         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ KUBERNETES APPLIES                        â”‚
                            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                            â”‚ â”‚ OLD DEPLOYMENT (running)            â”‚  â”‚
                            â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                            â”‚ â”‚ image: event-ingestion:old-tag      â”‚  â”‚
                            â”‚ â”‚ replicas: 2                         â”‚  â”‚
                            â”‚ â”‚ â”œâ”€ Pod 1 (old image) â”€â”€â”            â”‚  â”‚
                            â”‚ â”‚ â””â”€ Pod 2 (old image) â”€â”€â”¤ Terminate â”‚  â”‚
                            â”‚ â”‚                        â””â”€â”€â”€â”€â”€â”      â”‚  â”‚
                            â”‚ â”‚                              â”‚      â”‚  â”‚
                            â”‚ â”‚ NEW DEPLOYMENT (applying)    â”‚      â”‚  â”‚
                            â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”‚
                            â”‚ â”‚ â”‚ image: NEW_TAG âœ“        â”‚  â”‚      â”‚  â”‚
                            â”‚ â”‚ â”‚ replicas: 2             â”‚  â”‚      â”‚  â”‚
                            â”‚ â”‚ â”‚ â”œâ”€ Pod 1 (new) â—Šâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜      â”‚  â”‚
                            â”‚ â”‚ â”‚ â””â”€ Pod 2 (new) â—Šâ”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
                            â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
                            â”‚ â”‚                                      â”‚  â”‚
                            â”‚ â”‚ SERVICE (routes traffic)             â”‚  â”‚
                            â”‚ â”‚ Sends requests to new pods âœ…        â”‚  â”‚
                            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… DONE! New code running in production!
```

---

## Step-by-Step Image Update Flow

```
STEP 1: Developer Commits
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ src/consumer.py changed  â”‚
â”‚ git add consumer.py      â”‚
â”‚ git commit -m "fix: ..." â”‚
â”‚ git push origin main     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 2: GitHub Actions Triggers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Event: push to main                    â”‚
â”‚ Condition: Changes in                  â”‚
â”‚   services/event-ingestion-service/   â”‚
â”‚ Action: Run build-event-ingestion.yml â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 3: Build Phase
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Checkout code                             â”‚
â”‚    â””â”€ git clone (commit abc123)              â”‚
â”‚ 2. Run tests                                 â”‚
â”‚    â””â”€ pytest services/event-ingestion/       â”‚
â”‚ 3. Build Docker image                       â”‚
â”‚    â””â”€ docker build -t event-ingestion       â”‚
â”‚       Tag: event-ingestion:main-abc123      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 4: Push to ECR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ aws ecr get-login-password | docker login   â”‚
â”‚ docker push 647523695124.dkr.ecr.us-east-1. â”‚
â”‚             amazonaws.com/event-ingestion-   â”‚
â”‚             service:main-abc123              â”‚
â”‚                                              â”‚
â”‚ Image now in ECR! âœ“                         â”‚
â”‚ Digest: sha256:def456...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 5: Update Git Manifest â† KEY STEP! âœ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OLD deployment.yaml:                         â”‚
â”‚ image: .../event-ingestion-service:latest   â”‚
â”‚                                              â”‚
â”‚ GitHub Actions Updates:                      â”‚
â”‚ sed -i 's|image:.*event-ingestion:.*|       â”‚
â”‚         image: .../event-ingestion:         â”‚
â”‚         main-abc123|g' deployment.yaml      â”‚
â”‚                                              â”‚
â”‚ NEW deployment.yaml:                         â”‚
â”‚ image: ...event-ingestion-service:          â”‚
â”‚        main-abc123 â† NEW IMAGE TAG âœ“       â”‚
â”‚                                              â”‚
â”‚ git config user.name "GitHub Actions"       â”‚
â”‚ git add k8s/services/.../deployment.yaml    â”‚
â”‚ git commit -m "ci: bump image to ..."       â”‚
â”‚ git push origin main                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 6: Git Receives Update
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repository             â”‚
â”‚ main branch                   â”‚
â”‚                              â”‚
â”‚ Commit: a1b2c3d (NEW!)       â”‚
â”‚ Author: GitHub Actions        â”‚
â”‚ Message: ci: bump image...   â”‚
â”‚                              â”‚
â”‚ Changed File:                â”‚
â”‚ k8s/services/.../            â”‚
â”‚ deployment.yaml              â”‚
â”‚ [image tag updated]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 7: ArgoCD Polls Git
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ArgoCD watches                         â”‚
â”‚ repo: github.com/sheeffii/             â”‚
â”‚       RealtimeGaming.git               â”‚
â”‚ branch: main                           â”‚
â”‚ path: k8s/services/event-ingestion     â”‚
â”‚                                        â”‚
â”‚ Every 3 minutes (or via webhook):      â”‚
â”‚ "Any changes?"                         â”‚
â”‚                                        â”‚
â”‚ COMPARES:                              â”‚
â”‚ Git deployment.yaml     VS             â”‚
â”‚ Kubernetes deployment                  â”‚
â”‚                                        â”‚
â”‚ Git has:     main-abc123               â”‚
â”‚ K8s has:     main-old999               â”‚
â”‚                                        â”‚
â”‚ RESULT: OutOfSync âš ï¸                  â”‚
â”‚ (Kubernetes doesn't match Git)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 8: ArgoCD Shows UI Alert
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ArgoCD Dashboard                     â”‚
â”‚ https://argocd.gamemetrics.local    â”‚
â”‚                                      â”‚
â”‚ Application: event-ingestion-prod   â”‚
â”‚ Status: OutOfSync âš ï¸                â”‚
â”‚                                      â”‚
â”‚ Diff:                               â”‚
â”‚ - image: ...main-old999 (K8s)      â”‚
â”‚ + image: ...main-abc123 (Git)      â”‚
â”‚                                      â”‚
â”‚ [SYNC] Button Available             â”‚
â”‚ (Operator must approve)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 9: Operator Approves
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DevOps Engineer Reviews:             â”‚
â”‚ - What changed? (diff preview)       â”‚
â”‚ - Who made it? (GitHub Actions)      â”‚
â”‚ - When? (commit timestamp)           â”‚
â”‚ - Why? (commit message)              â”‚
â”‚                                      â”‚
â”‚ Clicks: [SYNC] Button               â”‚
â”‚ or runs: argocd app sync             â”‚
â”‚          event-ingestion-prod        â”‚
â”‚                                      â”‚
â”‚ Approval given âœ…                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 10: ArgoCD Syncs to Kubernetes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ArgoCD Sync Process                      â”‚
â”‚                                          â”‚
â”‚ 1. Read deployment.yaml from Git         â”‚
â”‚    image: ...main-abc123 âœ“              â”‚
â”‚                                          â”‚
â”‚ 2. Connect to Kubernetes API             â”‚
â”‚                                          â”‚
â”‚ 3. Update deployment spec                â”‚
â”‚    kubectl apply -f deployment.yaml     â”‚
â”‚                                          â”‚
â”‚ 4. Kubernetes sees new image             â”‚
â”‚    Starts rollout process               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 11: Kubernetes Rolls Out New Image
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROLLOUT PROCESS                             â”‚
â”‚                                             â”‚
â”‚ Replica 1 Update:                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ Pod 1 (old image) â“§             â”‚        â”‚
â”‚ â”‚ Terminating...                 â”‚        â”‚
â”‚ â”‚ Grace period: 30s               â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                â†“                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ Pod 1 (new image) â“ âŸµ NEW!    â”‚        â”‚
â”‚ â”‚ Starting                       â”‚        â”‚
â”‚ â”‚ Running health checks          â”‚        â”‚
â”‚ â”‚ Ready!                         â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                            â”‚
â”‚ Replica 2 Update:                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ Pod 2 (old image) â“§             â”‚        â”‚
â”‚ â”‚ Terminating...                 â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                â†“                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚ Pod 2 (new image) â“ âŸµ NEW!    â”‚        â”‚
â”‚ â”‚ Running                        â”‚        â”‚
â”‚ â”‚ Ready!                         â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                            â”‚
â”‚ Traffic: Service routes to new pods âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“

STEP 12: DONE! âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ event-ingestion pods now running:    â”‚
â”‚ - Pod 1: event-ingestion:main-abc123 â”‚
â”‚ - Pod 2: event-ingestion:main-abc123 â”‚
â”‚                                      â”‚
â”‚ Service receives requests âœ“          â”‚
â”‚ Routes to new pods âœ“                 â”‚
â”‚ New code handling requests âœ“         â”‚
â”‚                                      â”‚
â”‚ Old image: GONE                      â”‚
â”‚ New image: RUNNING                   â”‚
â”‚ Status: In Sync âœ“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timeline

```
TIME        ACTION                          STATUS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=0m        Developer pushes code           ğŸ”µ In Progress
T=1m        GitHub Actions builds image     ğŸ”µ In Progress
T=2m        GitHub Actions pushes to ECR    ğŸ”µ In Progress
T=3m        GitHub Actions updates Git      âœ… DONE
T=3m        ArgoCD polls and detects        ğŸ”µ In Progress
T=3m        ArgoCD shows OutOfSync          âš ï¸  ATTENTION
T=5m        Operator reviews and approves   ğŸ”µ In Progress
T=5m        ArgoCD syncs to Kubernetes      ğŸ”µ In Progress
T=6m        Kubernetes starts new pods      ğŸ”µ In Progress
T=7m        New pods healthy and ready      âœ… DONE
T=8m        Traffic routing to new pods     âœ… DONE
T=10m       Old pods terminated             âœ… DONE

TOTAL TIME: ~10 minutes (including manual approval)
```

---

## What Each Component Does

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                GITHUB ACTIONS                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Purpose: CI/CD automation                           â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Jobs:                                               â”‚ â”‚
â”‚ â”‚ 1. build-and-push                                   â”‚ â”‚
â”‚ â”‚    â””â”€ Builds Docker image, pushes to ECR           â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ 2. deploy-to-prod                                   â”‚ â”‚
â”‚ â”‚    â””â”€ Updates deployment.yaml in Git               â”‚ â”‚
â”‚ â”‚    â””â”€ Commits to main branch                       â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ 3. deploy-to-dev                                    â”‚ â”‚
â”‚ â”‚    â””â”€ Updates deployment.yaml in Git               â”‚ â”‚
â”‚ â”‚    â””â”€ Commits to develop branch                    â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Result: New image tag in Git âœ“                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GIT (GitHub)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Purpose: Source of truth                           â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Contains:                                           â”‚ â”‚
â”‚ â”‚ 1. Application code                                â”‚ â”‚
â”‚ â”‚ 2. Deployment manifests                            â”‚ â”‚
â”‚ â”‚ 3. Infrastructure-as-Code                          â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Triggers:                                           â”‚ â”‚
â”‚ â”‚ â””â”€ When deployment.yaml changes, webhooks fire    â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Result: Changes propagate to ArgoCD âœ“             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ARGOCD                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Purpose: GitOps deployment                         â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Watches:                                            â”‚ â”‚
â”‚ â”‚ â””â”€ Git repository for changes                      â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Compares:                                           â”‚ â”‚
â”‚ â”‚ â””â”€ Git manifests vs Kubernetes state               â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Actions:                                            â”‚ â”‚
â”‚ â”‚ â”œâ”€ Detects drift (OutOfSync)                      â”‚ â”‚
â”‚ â”‚ â”œâ”€ Shows in UI dashboard                          â”‚ â”‚
â”‚ â”‚ â”œâ”€ Waits for approval (prod)                      â”‚ â”‚
â”‚ â”‚ â””â”€ Syncs changes to Kubernetes                     â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Result: Kubernetes matches Git âœ“                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                KUBERNETES (EKS)                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Purpose: Run containerized applications            â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Processes:                                          â”‚ â”‚
â”‚ â”‚ â”œâ”€ Receives new deployment spec from ArgoCD       â”‚ â”‚
â”‚ â”‚ â”œâ”€ Compares with current deployment               â”‚ â”‚
â”‚ â”‚ â”œâ”€ Starts new pods with new image                 â”‚ â”‚
â”‚ â”‚ â”œâ”€ Waits for health checks                        â”‚ â”‚
â”‚ â”‚ â”œâ”€ Terminates old pods                            â”‚ â”‚
â”‚ â”‚ â””â”€ Routes traffic to new pods                      â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Result: New image running âœ“                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ECR (AWS)                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Purpose: Container image registry                  â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Stores:                                             â”‚ â”‚
â”‚ â”‚ â”œâ”€ Docker images built by GitHub Actions          â”‚ â”‚
â”‚ â”‚ â”œâ”€ Image tags and versions                         â”‚ â”‚
â”‚ â”‚ â””â”€ Image metadata and logs                         â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Used by:                                            â”‚ â”‚
â”‚ â”‚ â””â”€ Kubernetes to pull images                       â”‚ â”‚
â”‚ â”‚                                                      â”‚ â”‚
â”‚ â”‚ Result: Images available for deployment âœ“         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
INPUT: Developer commits code
    â”‚
    â†“
GITHUB ACTIONS
    â”‚
    â”œâ”€â†’ Build Image
    â”‚       â†“
    â”‚   Docker Engine
    â”‚       â†“
    â”‚   Creates: event-ingestion:main-abc123
    â”‚
    â”œâ”€â†’ Push to ECR
    â”‚       â†“
    â”‚   AWS ECR
    â”‚       â†“
    â”‚   Stores: 647523695124.dkr.ecr.../event-ingestion-service:main-abc123
    â”‚
    â”œâ”€â†’ Update Git
    â”‚       â†“
    â”‚   GitHub
    â”‚       â†“
    â”‚   deployment.yaml updated with new image tag
    â”‚
    â†“
ARGOCD (Pulls from Git)
    â”‚
    â”œâ”€â†’ Detect Change
    â”‚       â†“
    â”‚   Compares Git vs K8s
    â”‚       â†“
    â”‚   Finds: Image tag mismatch
    â”‚
    â”œâ”€â†’ Show OutOfSync
    â”‚       â†“
    â”‚   UI Alert
    â”‚       â†“
    â”‚   Operator sees notification
    â”‚
    â”œâ”€â†’ Approval
    â”‚       â†“
    â”‚   Operator clicks Sync
    â”‚
    â”œâ”€â†’ Apply to K8s
    â”‚       â†“
    â”‚   kubectl apply -f deployment.yaml
    â”‚
    â†“
KUBERNETES (Rolls out)
    â”‚
    â”œâ”€â†’ Schedule Pods
    â”‚       â†“
    â”‚   Scheduler finds nodes
    â”‚
    â”œâ”€â†’ Pull Image from ECR
    â”‚       â†“
    â”‚   Kubelet contacts ECR
    â”‚       â†“
    â”‚   Downloads: event-ingestion:main-abc123
    â”‚
    â”œâ”€â†’ Create Containers
    â”‚       â†“
    â”‚   Starts new pods
    â”‚       â†“
    â”‚   Runs health checks
    â”‚
    â”œâ”€â†’ Route Traffic
    â”‚       â†“
    â”‚   Service directs requests to new pods
    â”‚
    â”œâ”€â†’ Terminate Old
    â”‚       â†“
    â”‚   Removes old pods gracefully
    â”‚
    â†“
OUTPUT: New code running in production! âœ“
```

---

## Summary

- **GitHub Actions**: Builds image, updates Git manifest
- **Git**: Stores source of truth (deployment.yaml with new image)
- **ArgoCD**: Watches Git, detects changes, syncs to Kubernetes
- **Kubernetes**: Pulls image, runs pods, serves requests
- **ECR**: Stores Docker images

**Key**: Everything flows through Git!

