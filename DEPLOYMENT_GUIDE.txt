#!/bin/bash
#
# QUICK DEPLOYMENT GUIDE
# ArgoCD + Image Updater Fully Integrated
#
# This shows the exact commands to deploy your entire stack
#

cat << 'EOF'

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     GAMEMETRICS PRO - QUICK DEPLOYMENT GUIDE                   â•‘
â•‘                   ArgoCD + Image Updater Fully Integrated                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ DEPLOYMENT OPTIONS

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OPTION 1: Deploy to Existing Kubernetes Cluster (Quick)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Command:
    kubectl apply -k k8s/

  What Gets Deployed:
    âœ“ ArgoCD (GitOps)
    âœ“ ArgoCD Image Updater (automatic image updates)
    âœ“ Namespaces & RBAC
    âœ“ Kafka Cluster
    âœ“ Microservices (Event Ingestion, Notification Service)
    âœ“ Observability (Prometheus, Grafana, Loki, Tempo)
    âœ“ Secrets & ConfigMaps

  Duration: ~3-5 minutes

  Access ArgoCD:
    kubectl port-forward svc/argocd-server -n argocd 8080:443
    Open: https://localhost:8080
    Username: admin
    Password: kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OPTION 2: Production Deployment with AWS Infrastructure (Complete)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Command:
    ./scripts/production-deploy.sh us-east-1 prod

  What Gets Deployed:
    âœ“ AWS Infrastructure (EKS, RDS, ElastiCache, ECR, VPC)
    âœ“ EKS Cluster with Node Groups
    âœ“ ALL from Option 1 (K8s Stack + ArgoCD + Image Updater)

  Prerequisites:
    - AWS CLI configured with credentials
    - Terraform installed
    - Docker installed (for building images)

  Duration: ~20-30 minutes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OPTION 3: Deploy Only ArgoCD + Image Updater (Minimal)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Command:
    kubectl apply -k k8s/argocd/overlays
    kubectl apply -k k8s/argocd-image-updater/overlays/dev

  What Gets Deployed:
    âœ“ ArgoCD (without applications)
    âœ“ ArgoCD Image Updater

  Duration: ~1-2 minutes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ STEP-BY-STEP GUIDE (Option 1: Most Common)

  Step 1: Deploy
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    kubectl apply -k k8s/

    â³ Wait 30 seconds for resources to initialize...

  Step 2: Verify Installation
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ./scripts/validate-argocd-setup.sh

  Step 3: Access ArgoCD UI
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # In one terminal, start port-forward:
    kubectl port-forward svc/argocd-server -n argocd 8080:443

    # In another terminal, get the password:
    kubectl -n argocd get secret argocd-initial-admin-secret \
      -o jsonpath="{.data.password}" | base64 -d

    # Open browser: https://localhost:8080
    # Login: admin / <password from above>

  Step 4: Build and Deploy a Service
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ./scripts/build-push-ecr.sh notification-service

    â³ Wait ~2 minutes for Image Updater to detect and update...

    You'll see:
      â€¢ New image pushed to ECR
      â€¢ Image Updater updates ArgoCD Application
      â€¢ ArgoCD syncs the change
      â€¢ Kubernetes rolls new pods with new image

  Step 5: Monitor Auto-Updates
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Watch Image Updater logs:
    kubectl logs -n argocd-image-updater-system \
      -l app.kubernetes.io/name=argocd-image-updater -f

    # Watch ArgoCD syncing:
    kubectl logs -n argocd deployment/argocd-application-controller -f

    # Or use ArgoCD UI to watch in real-time

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š WHAT'S DEPLOYED BY `kubectl apply -k k8s/`

  Namespaces:
    âœ“ argocd                          (ArgoCD components)
    âœ“ argocd-image-updater-system    (Image Updater)
    âœ“ gamemetrics                     (Your applications)
    âœ“ kafka                           (Message broker)
    âœ“ monitoring                      (Observability)
    âœ“ databases                       (Data storage)

  ArgoCD Components:
    âœ“ argocd-server                   (Web UI + API)
    âœ“ argocd-application-controller   (Syncs apps)
    âœ“ argocd-repo-server              (Git integration)
    âœ“ argocd-dex-server               (OAuth)
    âœ“ argocd-redis                    (Cache)

  Image Updater Components:
    âœ“ argocd-image-updater-controller (ECR monitoring)
    âœ“ ImageUpdater CRD                (Configuration)
    âœ“ RBAC Resources                  (ServiceAccount, Roles)

  Kafka:
    âœ“ Strimzi Operator
    âœ“ Kafka Broker StatefulSet
    âœ“ Kafka Controller
    âœ“ Kafka Topics

  Applications:
    âœ“ event-ingestion-service
    âœ“ notification-service
    âœ“ (other configured services)

  Observability:
    âœ“ Prometheus                      (Metrics)
    âœ“ Grafana                         (Dashboards)
    âœ“ Loki                            (Logs)
    âœ“ Promtail                        (Log forwarder)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” VERIFICATION COMMANDS

  Check all pods:
    kubectl get pods -A

  Check ArgoCD pods:
    kubectl get pods -n argocd

  Check Image Updater pod:
    kubectl get pods -n argocd-image-updater-system

  Check services running:
    kubectl get svc -n gamemetrics

  Check Image Updater status:
    kubectl get deployment argocd-image-updater-controller \
      -n argocd-image-updater-system

  Check Image Updater logs:
    kubectl logs -n argocd-image-updater-system \
      -l app.kubernetes.io/name=argocd-image-updater

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š DOCUMENTATION

  Main Integration Guide:
    docs/ARGOCD_INTEGRATION.md

  Quick Reference (Commands):
    docs/ARGOCD_QUICK_REFERENCE.md

  Detailed Setup:
    docs/ARGOCD_SETUP.md

  Image Updater Details:
    k8s/argocd-image-updater/README.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ FREQUENTLY ASKED QUESTIONS

  Q: How do I deploy?
  A: kubectl apply -k k8s/

  Q: Do I still need bootstrap-argocd.sh?
  A: No, it's integrated. But you can still use it manually if preferred.

  Q: How long does deployment take?
  A: 3-5 minutes for Kubernetes stack. 20-30 minutes for production (with AWS).

  Q: Can I deploy to different environments?
  A: Yes, create overlays in k8s/argocd-image-updater/overlays/prod/

  Q: How do automatic image updates work?
  A: Build image â†’ Push to ECR â†’ Image Updater detects (2min) â†’ Updates App â†’ Pod restarts

  Q: What if Image Updater doesn't work?
  A: Check logs: kubectl logs -n argocd-image-updater-system -l app.kubernetes.io/name=argocd-image-updater

  Q: Can I customize the update interval?
  A: Yes, edit k8s/argocd-image-updater/overlays/<env>/kustomization.yaml

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… SUCCESS CHECKLIST

After running deployment:

  [ ] ArgoCD pods running (kubectl get pods -n argocd)
  [ ] Image Updater pod running (kubectl get pods -n argocd-image-updater-system)
  [ ] ArgoCD UI accessible (https://localhost:8080 after port-forward)
  [ ] Services deployed (kubectl get svc -n gamemetrics)
  [ ] Kafka running (kubectl get pods -n kafka)
  [ ] Can build and push image: ./scripts/build-push-ecr.sh notification-service
  [ ] Image updates detected within 2 minutes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ QUICK START (TL;DR)

  # Deploy everything
  kubectl apply -k k8s/

  # Get ArgoCD password
  kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

  # Port forward to UI
  kubectl port-forward svc/argocd-server -n argocd 8080:443

  # Open browser
  open https://localhost:8080

  # Login and explore!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

That's it! Your GitOps platform with automatic image updates is ready! ğŸ‰

EOF
